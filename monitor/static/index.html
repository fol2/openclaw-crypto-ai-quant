<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="color-scheme" content="dark" />
    <title>AI Quant â€” Live Desk</title>
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body data-mobile-view="list">
    <a class="skip" href="#main">Skip to content</a>

    <!-- ========== TOPBAR ========== -->
    <header class="topbar">
      <div class="topbar-left">
        <div class="brand">
          <div class="mark" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" width="18" height="18">
              <path d="M12 2L2 7l10 5 10-5-10-5z" fill="rgba(0,212,170,0.7)"/>
              <path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke="rgba(0,212,170,0.5)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="brandtext">
            <h1 class="title">AI Quant</h1>
            <div class="subtitle">Live Trading Desk</div>
          </div>
        </div>

        <div class="seg" role="tablist" aria-label="Mode">
          <button id="modeLive" class="segbtn" role="tab" aria-selected="true" data-mode="live">LIVE</button>
          <button id="modePaper1" class="segbtn" role="tab" aria-selected="false" data-mode="paper1">P1</button>
          <button id="modePaper2" class="segbtn" role="tab" aria-selected="false" data-mode="paper2">P2</button>
          <button id="modePaper3" class="segbtn" role="tab" aria-selected="false" data-mode="paper3">P3</button>
        </div>
      </div>

      <div class="topbar-right">
        <div class="pill" id="connPill" title="Monitor server health">
          <span class="dot" id="connDot"></span>
          <span class="pilltxt" id="connTxt" aria-live="polite">connecting</span>
        </div>

        <div class="pill pill-val" id="balRealPill" title="Realised cash (last trade balance)">
          <span class="pillk">realised</span>
          <span class="pillv" id="balReal">&mdash;</span>
        </div>

        <div class="pill pill-val" id="balEqPill" title="Equity estimate = realised + uPnL - est close fees">
          <span class="pillk">equity</span>
          <span class="pillv" id="balEq">&mdash;</span>
        </div>

        <div class="pill pill-state" id="statePill" title="Risk kill switch state">
          <span class="dot" id="stateDot"></span>
          <span class="pilltxt" id="stateTxt" aria-live="polite">running</span>
        </div>

        <div class="pill pill-state" id="regimePill" title="Regime gate (trend OK vs chop)">
          <span class="dot" id="regimeDot"></span>
          <span class="pilltxt" id="regimeTxt" aria-live="polite">gate</span>
        </div>

        <div class="pill pill-val" id="cfgPill" title="Active config_id (from engine heartbeat)">
          <span class="pillk">cfg</span>
          <span class="pillv" id="cfgId">&mdash;</span>
        </div>

        <div class="pill pill-val" id="pnlTodayPill" title="Today's PnL (UTC day, realised balance delta)">
          <span class="pillk">pnl</span>
          <span class="pillv" id="pnlToday">&mdash;</span>
        </div>

        <div class="pill pill-val" id="ddPill" title="Drawdown from peak realised balance (UTC day)">
          <span class="pillk">dd</span>
          <span class="pillv" id="ddNow">&mdash;</span>
        </div>

        <div class="pill pill-val" id="dataPill" title="Last market data timestamp (WS mids)">
          <span class="pillk">data</span>
          <span class="pillv" id="dataTs">&mdash;</span>
        </div>

        <label class="search">
          <span class="kbd">/</span>
          <input id="search" type="search" placeholder="Filter symbols..." autocomplete="off" />
        </label>

        <button class="ghost" id="pauseBtn" title="Pause UI updates">
          <span id="pauseTxt">PAUSE</span>
        </button>
      </div>
    </header>

    <!-- ========== VIEW TABS ========== -->
    <div class="viewtabs">
      <div class="seg" role="tablist" aria-label="View">
        <button id="viewDash" class="segbtn is-on" role="tab" aria-selected="true" data-view-tab="dashboard">DASHBOARD</button>
        <button id="viewDecisions" class="segbtn" role="tab" aria-selected="false" data-view-tab="decisions">DECISIONS</button>
      </div>
    </div>

    <!-- ========== MAIN LAYOUT ========== -->
    <main id="main" class="layout">

      <!-- LEFT PANEL: Universe -->
      <section class="panel left">
        <div class="panelhd">
          <h2 class="h">Universe</h2>
          <div class="meta">
            <span id="symCount">&mdash;</span>
            <span class="sep">&middot;</span>
            <span id="openCount">&mdash;</span>
            <span class="sep">&middot;</span>
            <span id="hbAge">&mdash;</span>
          </div>
        </div>

        <div class="tablewrap">
          <table class="symtable">
            <thead>
              <tr>
                <th>SYM</th>
                <th class="num">MID</th>
                <th title="Last saved strategy signal (typically on candle close). Only shown if within 24h. Not an active order by itself.">SIGNAL</th>
                <th>POS</th>
              </tr>
            </thead>
            <tbody id="symBody"></tbody>
          </table>
        </div>
      </section>

      <!-- RESIZER: drag to resize panels -->
      <div class="resizer" id="panelResizer"></div>

      <!-- RIGHT PANEL: Detail -->
      <section class="panel detail" aria-labelledby="detailTitle">
        <div class="panelhd">
          <h2 class="h" id="detailTitle">Focus</h2>
          <div class="meta">
            <span id="detailMid">&mdash;</span>
            <span class="sep">&middot;</span>
            <span id="detailSig">&mdash;</span>
            <span class="sep">&middot;</span>
            <span id="loopWall">&mdash;</span>
            <span class="sep">&middot;</span>
            <span id="wsRestarts">&mdash;</span>
            <span class="sep">&middot;</span>
            <span id="errs">&mdash;</span>
          </div>
        </div>

        <div class="detailbody">
          <!-- Chart -->
          <div class="sparkcard">
            <div class="sparkbar">
              <div class="sparkcontrols">
                <div class="seg mini" role="tablist" aria-label="Chart source">
                  <button id="chartModeTicks" class="segbtn mini is-on" role="tab" aria-selected="true" data-chart="ticks">TICKS</button>
                  <button id="chartModeCandles" class="segbtn mini" role="tab" aria-selected="false" data-chart="candles">CANDLES</button>
                </div>
                <div class="seg mini" id="tickRanges" aria-label="Tick window">
                  <button class="segbtn mini" data-window="300">5m</button>
                  <button class="segbtn mini is-on" data-window="900">15m</button>
                  <button class="segbtn mini" data-window="3600">1h</button>
                </div>
                <div class="seg mini is-hidden" id="candleRanges" aria-label="Candle window"></div>
                <div class="seg mini is-hidden" id="candleIntervals" aria-label="Candle interval"></div>
                <div class="seg mini is-hidden" id="candleInd" aria-label="Indicators"></div>
              </div>
              <div class="sparkmeta" id="sparkMeta">&mdash;</div>
            </div>
            <canvas id="spark" width="900" height="380" aria-label="Mid sparkline"></canvas>
            <div class="sparklegend">
              <div class="tag" id="sparkTag">&mdash;</div>
              <div class="tag subtle" id="sparkSub">&mdash;</div>
            </div>
          </div>

          <!-- Cards + Feed -->
          <div class="detaillayout">
            <div class="card poscard">
              <div class="cardhd">
                <div class="k">Open Position</div>
                <div class="v" id="posSummary">&mdash;</div>
              </div>
              <div class="kv" id="posKv">&mdash;</div>
              <details class="raw">
                <summary>Raw JSON</summary>
                <pre class="code" id="posJson">&mdash;</pre>
              </details>
            </div>

            <div class="card buycard">
              <div class="cardhd">
                <div class="k" title="Latest record for this symbol: last saved signal + last OMS intent + last trade. Not necessarily an active order.">Buy Decision</div>
                <div class="v" id="decSummary">&mdash;</div>
              </div>
              <div class="kv" id="decKv">&mdash;</div>
              <details class="raw">
                <summary>Raw JSON</summary>
                <pre class="code" id="decJson">&mdash;</pre>
              </details>
            </div>

            <div class="card feed">
              <div class="feedhd">
                <div class="tabs">
                  <button class="tab is-on" data-feed="trades">Trades</button>
                  <button class="tab" data-feed="oms">OMS</button>
                  <button class="tab" data-feed="audit">Audit</button>
                </div>
                <div class="hint">latest first</div>
              </div>

              <div id="feedTrades" class="feedbody"></div>
              <div id="feedOms" class="feedbody is-hidden"></div>
              <div id="feedAudit" class="feedbody is-hidden"></div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- ========== DECISIONS VIEW ========== -->
    <section id="decisionsView" class="decisions-view is-hidden">
      <div class="dec-toolbar">
        <div class="dec-filters">
          <label class="dec-filter-group">
            <span class="dec-label">Symbol</span>
            <select id="decFilterSymbol" class="dec-select">
              <option value="">All</option>
            </select>
          </label>
          <label class="dec-filter-group">
            <span class="dec-label">Event</span>
            <select id="decFilterEvent" class="dec-select">
              <option value="">All</option>
              <option value="entry_signal">entry_signal</option>
              <option value="exit_check">exit_check</option>
              <option value="gate_block">gate_block</option>
              <option value="fill">fill</option>
              <option value="funding">funding</option>
            </select>
          </label>
          <label class="dec-filter-group">
            <span class="dec-label">Status</span>
            <select id="decFilterStatus" class="dec-select">
              <option value="">All</option>
              <option value="executed">executed</option>
              <option value="blocked">blocked</option>
              <option value="rejected">rejected</option>
              <option value="hold">hold</option>
            </select>
          </label>
          <label class="dec-filter-group">
            <span class="dec-label">From</span>
            <input id="decFilterStart" type="datetime-local" class="dec-input" />
          </label>
          <label class="dec-filter-group">
            <span class="dec-label">To</span>
            <input id="decFilterEnd" type="datetime-local" class="dec-input" />
          </label>
        </div>
        <div class="dec-actions">
          <button id="decApplyBtn" class="ghost" type="button">APPLY</button>
          <button id="decClearBtn" class="ghost" type="button">CLEAR</button>
          <button id="decExportBtn" class="ghost" type="button">EXPORT JSON</button>
        </div>
      </div>
      <div class="dec-summary" id="decSummaryBar">&mdash;</div>
      <div class="dec-timeline" id="decTimeline">
        <div class="dec-empty">Apply filters to load decision events.</div>
      </div>
      <div class="dec-pager">
        <button id="decLoadMore" class="ghost" type="button" style="display:none;">LOAD MORE</button>
      </div>
    </section>

    <!-- ========== DECISION DETAIL MODAL ========== -->
    <div id="decModal" class="modal is-hidden" aria-hidden="true">
      <div class="modalback" data-dec-modal-close="true" aria-hidden="true"></div>
      <div class="modalcard dec-modalcard" role="dialog" aria-modal="true" aria-labelledby="decModalTitle">
        <div class="modalhd">
          <div class="modaltitle" id="decModalTitle">&mdash;</div>
          <button class="modalclose" id="decModalClose" type="button" aria-label="Close">CLOSE</button>
        </div>
        <div class="dec-modal-body" id="decModalBody">
          <div class="dec-modal-section" id="decModalContext">
            <div class="dec-modal-section-title">Indicator Snapshot</div>
            <div class="kv" id="decModalIndicators">&mdash;</div>
          </div>
          <div class="dec-modal-section" id="decModalGates">
            <div class="dec-modal-section-title">Gate Evaluations</div>
            <div class="dec-gates-table-wrap">
              <table class="dec-gates-table" id="decModalGateTable">
                <thead>
                  <tr>
                    <th>Gate</th>
                    <th>Pass</th>
                    <th>Metric</th>
                    <th>Threshold</th>
                    <th>Op</th>
                    <th>Explanation</th>
                  </tr>
                </thead>
                <tbody id="decModalGateBody"></tbody>
              </table>
            </div>
          </div>
          <div class="dec-modal-section" id="decModalMeta">
            <div class="dec-modal-section-title">Decision Metadata</div>
            <div class="kv" id="decModalMetaKv">&mdash;</div>
          </div>
          <div class="dec-modal-actions">
            <button id="decReplayBtn" class="ghost" type="button">REPLAY DECISION</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== MODAL ========== -->
    <div id="modal" class="modal is-hidden" aria-hidden="true">
      <div class="modalback" data-modal-close="true" aria-hidden="true"></div>
      <div class="modalcard" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modalhd">
          <div class="modaltitle" id="modalTitle">&mdash;</div>
          <button class="modalclose" id="modalClose" type="button" aria-label="Close">CLOSE</button>
        </div>
        <div class="modalmeta" id="modalMeta">&mdash;</div>
        <pre class="modalbody code" id="modalBody">&mdash;</pre>
      </div>
    </div>

    <!-- ========== MOBILE NAV ========== -->
    <nav class="mobilenav" aria-label="Mobile view switcher">
      <button id="mnavList" class="mnavbtn is-on" type="button" data-view="list" aria-selected="true">TOKENS</button>
      <button id="mnavFocus" class="mnavbtn" type="button" data-view="focus" aria-selected="false">FOCUS</button>
    </nav>

    <!-- ========== FOOTER ========== -->
    <footer class="foot">
      <div class="small">
        Read-only dashboard &middot; Data: SQLite + logs + market WS allMids
      </div>
      <div class="small right">
        <span id="ts">&mdash;</span>
      </div>
    </footer>

    <script src="/static/app.js"></script>
  </body>
</html>
